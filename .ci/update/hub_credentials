#!/bin/bash
set -e pipefail
# updates all sites for a specific upstream
# will not update sites that have uninitialized environments (test or live)
environment=dev

MYSQL_CREDS=$(terminus connection:info legacy-creighton-hub.dev --fields='mysql_url' --format=string)
CURRENT_MYSQL_CREDS=$(terminus secrets:show legacy-creighton-hub.dev hub_db_url)

if [[ ${CURRENT_MYSQL_CREDS} != ${MYSQL_CREDS} ]] ; then
    terminus secrets:set legacy-creighton-admissions.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-adult-degrees.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-business.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-ccas.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-dentistry.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-ems.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-excellence.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-health-sciences.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-hub.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-law.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-med-school.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-nursing.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-spahp.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-student-life.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-www.$environment hub_db_url $MYSQL_CREDS
    terminus secrets:set legacy-creighton-www15.$environment hub_db_url $MYSQL_CREDS
fi